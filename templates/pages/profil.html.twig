{% extends 'base.html.twig' %}

{% block title %}Profil - Portál značkaře{% endblock %}

{% block body %}
    {% if not app.user %}
        <div class="container container--sm">
            {% include 'components/alert.html.twig' with {
                type: 'warning',
                title: 'Přihlášení vyžadováno',
                content: 'Pro zobrazení profilu se musíte přihlásit.',
                actions: [
                    {
                        url: path('app_index'),
                        text: 'Úvod'
                    },
                    {
                        url: path('app_login'),
                        text: 'Přihlásit se'
                    }
                ]
            } %}
        </div>
    {% else %}
        <div class="container container--lg">
            {% include 'components/page-header.html.twig' with {
                title: 'Můj profil',
                subtitle: 'Správa účtu a přehled statistik.',
                breadcrumbs: [
                    {
                        url: path('app_index'),
                        text: 'Úvod'
                    },
                    {
                        url: path('app_index'),
                        text: 'Nástěnka'
                    },
                    {
                        text: 'Profil'
                    }
                ]
            } %}

            <div class="grid gap-6">
                <!-- Základní informace z INSYZ -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">
                            {{ tabler_icon('user', 20, 'card__icon') }}
                            Údaje značkaře (INSYZ)
                        </h2>
                    </div>
                    <div class="card__content">
                        {% if insyz_data %}
                        <table class="table">
                            <tbody>
                                <tr>
                                    <td><strong>Jméno:</strong></td>
                                    <td>{{ insyz_data.Titul_Pred }} {{ insyz_data.Jmeno }} {{ insyz_data.Prijmeni }} {{ insyz_data.Titul_Za }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Email:</strong></td>
                                    <td>{{ insyz_data.eMail }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Průkaz značkaře:</strong></td>
                                    <td>{{ insyz_data.Prukaz_znackare }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Platnost do:</strong></td>
                                    <td>{{ insyz_data.Plati_Do }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Kraj/Obvod:</strong></td>
                                    <td>{{ insyz_data.Kraj }} / {{ insyz_data.Obvod }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Adresa:</strong></td>
                                    <td>{{ insyz_data.Ulice_cp }}, {{ insyz_data.PSC }} {{ insyz_data.Misto }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Telefon:</strong></td>
                                    <td>{{ insyz_data.Telefon_zakladni }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Dvojice:</strong></td>
                                    <td>{{ insyz_data.Dvojice_jmeno }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Funkce:</strong></td>
                                    <td>{{ insyz_data.Funkce_Ext ?: insyz_data.Funkce }}</td>
                                </tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="text--muted">Data značkaře nejsou dostupná.</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Odpracované kilometry -->
                {% if odpracovano is defined and odpracovano is not empty %}
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">
                            {{ tabler_icon('walk', 20, 'card__icon') }}
                            Odpracované kilometry
                        </h2>
                    </div>
                    <div class="card__content">
                        <div data-app="odpracovano-widget"
                             data-odpracovano="{{ odpracovano|json_encode }}"
                             data-show-table="true">
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Kvalifikace -->
                {% if kvalifikace %}
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">
                            {{ tabler_icon('certificate', 20, 'card__icon') }}
                            Kvalifikace
                        </h2>
                    </div>
                    <div class="card__content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Kvalifikace</th>
                                    <th>Místo</th>
                                    <th>Datum</th>
                                    <th>Zapsal</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for kval in kvalifikace %}
                                <tr>
                                    <td>{{ kval.Kvalifikace }} ({{ kval.Zkratka_Kval }})</td>
                                    <td>{{ kval.Misto_Kval }}</td>
                                    <td>{{ kval.Datum_Kval }}</td>
                                    <td>{{ kval.Zapsal_Kval }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}


                <!-- Semináře -->
                {% if seminare %}
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">
                                {{ tabler_icon('school', 20, 'card__icon') }}
                                Absolvované semináře
                            </h2>
                        </div>
                        <div class="card__content">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>Seminář</th>
                                    <th>Místo</th>
                                    <th>Datum</th>
                                    <th>Zapsal</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for sem in seminare %}
                                    <tr>
                                        <td>{{ sem.Seminar }}</td>
                                        <td>{{ sem.Misto_Sem }}</td>
                                        <td>{{ sem.Datum_Sem }}</td>
                                        <td>{{ sem.Zapsal_Sem }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {% endif %}

                <!-- Uživatelské preference -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">
                            {{ tabler_icon('settings', 20, 'card__icon') }}
                            Uživatelské preference
                        </h2>
                    </div>
                    <div class="card__content">
                        <!-- React aplikace pro správu preferencí -->
                        <div data-app="user-preferences"></div>
                    </div>
                </div>

                <!-- Akce účtu -->
                <div class="card">
                    <div class="card__header">
                        <h2 class="card__title">
                            {{ tabler_icon('user-cog', 20, 'card__icon') }}
                            Správa účtu
                        </h2>
                    </div>
                    <div class="card__content">
                        <div class="grid">
                            <div class="profile-setting">
                                <div class="profile-setting__info">
                                    <h4 class="profile-setting__title">Změna hesla</h4>
                                    <p class="profile-setting__desc">Aktualizace přihlašovacích údajů</p>
                                </div>
                                <button class="btn btn--secondary" onclick="alert('Změna hesla bude implementována v další fázi')">Změnit</button>
                            </div>
                            <div class="profile-setting profile-setting--danger">
                                <div class="profile-setting__info">
                                    <h4 class="profile-setting__title">Odhlásit se</h4>
                                    <p class="profile-setting__desc">Ukončit aktuální relaci</p>
                                </div>
                                <a href="{{ path('api_auth_logout') }}" class="btn btn--danger" onclick="return confirm('Opravdu se chcete odhlásit?')">Odhlásit</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block javascripts %}
    {% if app.user %}
        {{ encore_entry_script_tags('user-preferences') }}
        {{ encore_entry_script_tags('app-odpracovano-widget') }}
    {% endif %}
{% endblock %}